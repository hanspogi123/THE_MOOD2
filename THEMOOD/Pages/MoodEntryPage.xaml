<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:THEMOOD.ViewModels"
             xmlns:local="clr-namespace:THEMOOD.Pages"
             xmlns:controls="clr-namespace:THEMOOD.Controls"
             xmlns:micro="clr-namespace:Microcharts.Maui;assembly=Microcharts.Maui"
             xmlns:behaviors="clr-namespace:THEMOOD.Behaviors"
             x:Class="THEMOOD.Pages.MoodEntryPage">

    <ContentView.BindingContext>
        <vm:MoodEntry_VM/>
    </ContentView.BindingContext>

    <Grid RowDefinitions="*" BackgroundColor="{AppThemeBinding Light=#f8f8f8, Dark=#1a1a1a}">
        <Grid Padding="20">
            <Frame BorderColor="Transparent"
                   CornerRadius="20"
                   Padding="20"
                   HasShadow="False"
                   BackgroundColor="{AppThemeBinding Light=White, Dark=#2d1b2d}"
                   VerticalOptions="Center">
                <Frame.Shadow>
                    <Shadow Brush="#20000000"
                           Offset="0,2"
                           Radius="4" />
                </Frame.Shadow>
                <ScrollView>
                    <VerticalStackLayout Spacing="20" HorizontalOptions="Center">
                        <Label Text="Mood Tracker"
                               FontSize="24"
                               FontFamily="GentySans"
                               TextColor="{AppThemeBinding Light=Black, Dark=White}"
                               HorizontalOptions="Center" />

                        <!-- Chart View -->
                        <Frame x:Name="ChartFrame" CornerRadius="15" BackgroundColor="#f5f5f5" Margin="0" Padding="10" Style="{StaticResource FrameStyle}">
                            <VerticalStackLayout>
                                <Label Text="Mood Distribution"
                                       FontFamily="GentySans"
                                       TextColor="Black"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       HorizontalOptions="Center"
                                       Margin="0,0,0,5"/>
                                <micro:ChartView x:Name="Chart" HeightRequest="200"/>
                            </VerticalStackLayout>
                        </Frame>

                        <!-- Analysis Section -->
                        <Frame CornerRadius="15" BackgroundColor="#f5f5f5" Margin="0" Padding="10" Style="{StaticResource FrameStyle}">
                            <VerticalStackLayout>
                                <Label Text="Mood Analysis"
                                       TextColor="Black"
                                       FontSize="16"
                                       FontFamily="GentySans"
                                       FontAttributes="Bold"
                                       HorizontalOptions="Center"
                                       Margin="0,0,0,5"/>

                                <Label x:Name="AnalysisLabel"
                                       Text="AI Analysis on your mood would show after entering at least 3 moods"
                                       TextColor="Black"
                                       TextType="Html"
                                       Margin="5"/>
                            </VerticalStackLayout>
                        </Frame>

                        <!-- Add Mood Button -->
                        <Button
                            Text="Add Mood"
                            Clicked="AddMood_Clicked"
                            HorizontalOptions="Center"
                            BackgroundColor="#ff69b4"
                            TextColor="White"
                            FontFamily="GentySans"
                            Padding="20,10"
                            CornerRadius="20"
                            VerticalOptions="Center">
                            <Button.Behaviors>
                                <behaviors:SoundEffectBehavior SoundType="button" />
                            </Button.Behaviors>
                        </Button>

                        <!-- Mood History Title -->
                        <Label Text="Mood History"
                               FontFamily="GentySans"
                               TextColor="Black"
                               FontSize="16"
                               FontAttributes="Bold"
                               HorizontalOptions="Center" />

                        <!-- Mood Entries Collection -->
                        <CollectionView
                            x:Name="MoodLog"
                            SelectionMode="None"
                            Margin="0"
                            BackgroundColor="Transparent">
                            <CollectionView.ItemsLayout>
                                <LinearItemsLayout Orientation="Vertical" ItemSpacing="10" />
                            </CollectionView.ItemsLayout>
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="vm:MoodEntry_VM">
                                    <SwipeView>
                                        <!-- Right Swipe Item for Deletion -->
                                        <SwipeView.RightItems>
                                            <SwipeItems Mode="Reveal">
                                                <SwipeItem
                                                    Text="   Delete"
                                                    BackgroundColor="Crimson"
                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type local:MoodEntryPage}}, Path=DeleteCommand}"
                                                    CommandParameter="{Binding .}">
                                                    <SwipeItem.IconImageSource>
                                                        <FontImageSource Glyph="🗑️" Color="White" Size="20" />
                                                    </SwipeItem.IconImageSource>
                                                </SwipeItem>
                                            </SwipeItems>
                                        </SwipeView.RightItems>

                                        <!-- SwipeView Content -->
                                        <SwipeView.Content>
                                            <Frame
                                                CornerRadius="20"
                                                BorderColor="#E91E63"
                                                Padding="10"
                                                HasShadow="True"
                                                Margin="5">
                                                <Frame.Background>
                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                        <GradientStop Color="White" Offset="0.0" />
                                                        <GradientStop Color="LightPink" Offset="0.5" />
                                                        <GradientStop Color="Pink" Offset="1.0" />
                                                    </LinearGradientBrush>
                                                </Frame.Background>
                                                <Grid
                                                    RowDefinitions="Auto, Auto"
                                                    ColumnDefinitions="2*, 3*, 3*"
                                                    ColumnSpacing="10"
                                                    Padding="5">
                                                    <!-- Mood Icon -->
                                                    <Label
                                                        Text="{Binding MoodIcon}"
                                                        FontSize="60"
                                                        VerticalOptions="Center"
                                                        HorizontalOptions="Center"
                                                        Grid.Column="0"
                                                        Grid.RowSpan="2" />
                                                    <!-- Mood Text -->
                                                    <Label
                                                        Text="{Binding Mood}"
                                                        FontSize="18"
                                                        FontAttributes="Bold"
                                                        TextColor="Black"
                                                        Grid.Column="1" />
                                                    <!-- Date -->
                                                    <Label
                                                        Text="{Binding FormattedDate}"
                                                        FontSize="14"
                                                        FontAttributes="Italic"
                                                        TextColor="DimGray"
                                                        Grid.Column="2"
                                                        HorizontalOptions="End" />
                                                    <!-- Mood Note -->
                                                    <Label
                                                        Text="{Binding Note}"
                                                        FontSize="14"
                                                        TextColor="Black"
                                                        Grid.Row="1"
                                                        Grid.Column="1"
                                                        Grid.ColumnSpan="2"
                                                        LineBreakMode="WordWrap" />
                                                </Grid>
                                            </Frame>
                                        </SwipeView.Content>
                                    </SwipeView>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </ScrollView>
            </Frame>
        </Grid>
    </Grid>
</ContentView>